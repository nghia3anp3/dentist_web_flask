<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">

  <title>Dentist Register</title>
  <!-- Remove the extra closing tag for the style element -->
</head>
<body>
  <script src="https://code.jquery.com/jquery-3.6.4.min.js" integrity="sha384-UG8ao2jwOWB7/oDdObZc6ItJmwUkR/PfMyt9Qs5AwX7PsnYn1CRKCTWyncPTWvaS" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
  {%include "./nhanvien/navbar.html" %}
  <div class="container">
    <div class="row">
      <div class="col-4">{%include "./nhanvien/xuat_hoa_don_sidebar.html" %} </div>

      <div class="col-6">
        <form id="confirmationForm" class="card p-2">
          <div class="input-group">
            <input id="userInput" type="text" class="form-control" placeholder="Nhập số điện thoại của bạn tại đây">
            <button type="button" class="btn btn-secondary" onclick="checkAndShowPopup()">Xác nhận</button>
          </div>
        </form>

        
      <div id="popupForm" style="display:none;">
        {%include "./nhanvien/xuat_hoa_don_ko_hd.html"%}
      </div> 

      <div id="dropdown" style ="display:none;">
        <p class = "fs-5 fw-bold mb-3">Các hóa đơn của bạn như sau: </p>
          {%include "./nhanvien/xuat_hoa_don_hd.html"%}
      </div> 

      </div>
    </div>
  </div>

<script>
  function checkAndShowPopup() {
    var userInputValue = document.getElementById("userInput").value;
    sendQueryToDatabase(userInputValue)

     
  }

  function showPopup() {
    // You can modify this function to display the popup as needed
    document.getElementById("popupForm").style.display = "block";
  }
  function hidePopup() {
    // You can modify this function to display the popup as needed
    document.getElementById("popupForm").style.display = "none";
  }
  function showDropdown() {
    // You can modify this function to display the popup as needed
    document.getElementById("dropdown").style.display = "block";
  }
  function hideDropdown() {
    // You can modify this function to display the popup as needed
    document.getElementById("dropdown").style.display = "none";
  }
  
  function sendQueryToDatabase(userInputValue) {
    $.ajax({
      type: "GET",
      url: "/query-database-xuat_hoa_don", // Update this with the actual route in your Flask app
      data: { userInput: userInputValue },
      success: function (data) {
        // Handle the data received from the server (e.g., update the table)
        console.log("Data from server:", data["hoadon"]);
        console.log("Data from server123:", typeof data);
        hidePopup ();
        if (typeof data == 'object' && data["hoadon"].length > 0) {
          // Data exists, update the form with the received data

            console.log("hoa don", data["hoadon"][0]);
            updateFormWithData (data["hoadon"][0])
            showDropdown();
          
          
        } else {
          // No data, display the form with the message
          console.log("ssss");
          showPopup();
          hideDropdown();
        }
      },
      error: function (error) {
        console.error("Error:", error);
      }
    });
  }

  function updateFormWithData(data) {
    // Assuming 'hoa_don' is the variable you want to update
    // Replace this line with the actual data mapping based on your server response
    hoa_don = data;
  
    // Update the content of your form using the received data
    document.getElementById("ma_ho_so").innerText =  "Mã hóa đơn: " + data.mahoadon;
    // Update other elements similarly...
    document.getElementById("ma_thuoc").innerText = data.mathuoc;
    document.getElementById("ten_thuoc").innerText = data.tenthuoc;
    document.getElementById("so_luong_thuoc").innerText =  data.soluongthuoc;
    document.getElementById("don_gia_thuoc").innerText =  data.dongia;
    // Update other elements related to Thuốc similarly...

    // Update elements related to Dịch Vụ
    document.getElementById("ma_dv").innerText = data.madv;
    document.getElementById("ten_dv").innerText =  data.tendv;
    document.getElementById("so_luong_dv").innerText = data.soluongdv;
    document.getElementById("don_gia_dv").innerText =data.dongiadichvu;
    // Update other elements related to Dịch Vụ similarly...

    // Update elements related to Nhân Viên
    document.getElementById("ten_nhan_vien").innerText = "Họ Tên Nhân Viên: " ;
    document.getElementById("thanh_tien").innerText = "Thành Tiền: " + data.tongtien;
    // You may need to update the tables as well based on your data structure
  }

  function createFormForHoadon(hoadonData) {
    // Create a new form element
    var form = document.createElement("form");
    form.classList.add("card", "p-2");
  
    // Append form to the existing container or create a new container for each form
    // For example, you can create a new div for each form
    var formContainer = document.getElementById("dropdown");
    formContainer.appendChild(form);
  
    // ... Add the necessary input fields and content to the form based on hoadonData
    // You can use the updateFormWithData function here or directly manipulate the form elements
  
    // For example, add the ma_ho_so element to the form
      var ma_ho_so = document.createElement("p");
      ma_ho_so.innerText = "Mã hóa đơn: " + hoadonData.mahoadon;
      form.appendChild(ma_ho_so);


  
    // Repeat similar steps for other elements in the form
  
    // Optionally, you can add a separator between forms
    var separator = document.createElement("hr");
    formContainer.appendChild(separator);
  }

</script>
</body>
</html>
